<!DOCTYPE html>
<html>
  <head>
    <style>
      .flex-container {
        display: flex;
        justify-content: center;
      }

      html,
      body {
        height: 100%;
        background-color: rgb(15, 15, 15);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      p {
        color: rgb(245, 245, 245);
        padding: 0.75em;
      }

      label {
        color: rgb(245, 245, 245);
        padding-bottom: 0.5em;
      }

      .soal {
        font-size: 1.5vw;
        color: rgb(225, 225, 225);
        align-content: center;
        text-align: left;
        background-color: rgb(30, 30, 30);
        border: 4px solid rgb(44, 44, 44);
        border-radius: 8px;
        margin: 25px;
        padding: 25px;
      }

      .pertanyaan {
        display: flex;
      }

      .isi-soal {
        text-align: center;
      }

      .isi-soal img {
        max-width: 50%;
        height: auto;
      }

      .isi-soal p {
        text-align: left;
      }

      .isi-soal ul {
        text-align: left;
      }

      :root {
        --input-border: #8b8a8b;
        --input-focus-h: 245;
        --input-focus-s: 100%;
        --input-focus-l: 42%;

        --button: #ffc022;
        --button-hover: #ffb700;

        --red-fill: #7e3c3c;
        --red-border: #a34f4f;

        --correct-border: #2db15e;
        --correct-fill: #c6ffcd;
        --correct-text: #21f785;

        --empty-border: #ffffc5;
        --empty-fill: #b1b63e;
        --empty-text: #e2dc00;

        --wrong-border: #ffbcb2;
        --wrong-fill: #d64747;
        --wrong-text: #ff7077;
      }

      input[type="text"] {
        font-size: 16px;
        font-size: max(16px, 1em);
        font-family: inherit;
        padding: 0.25em 0.5em;
        background-color: #fff;
        border: 2px solid var(--input-border);
        border-radius: 4px;
        transition: 180ms box-shadow ease-in-out;
      }

      input[type="text"]:focus {
        border-color: hsl(
          var(--input-focus-h),
          var(--input-focus-s),
          var(--input-focus-l)
        );
        box-shadow: 0 0 0 3px
          hsla(
            var(--input-focus-h),
            var(--input-focus-s),
            calc(var(--input-focus-l) + 40%),
            0.8
          );
        outline: 3px solid transparent;
      }

      #content {
        display: none;
      }

      @keyframes ldio-lrl344qrunr {
        0% {
          transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }
      .ldio-lrl344qrunr div {
        position: absolute;
        width: 60px;
        height: 60px;
        border: 10px solid #ffffff;
        border-top-color: transparent;
        border-radius: 50%;
      }
      .ldio-lrl344qrunr div {
        animation: ldio-lrl344qrunr 1s linear infinite;
        top: 50px;
        left: 50px;
      }
      .loadingio-spinner-rolling-xhhxmtgsuq {
        width: 100px;
        height: 100px;
        display: inline-block;
        overflow: hidden;
        background: none;
      }
      .ldio-lrl344qrunr {
        width: 100%;
        height: 100%;
        position: relative;
        transform: translateZ(0) scale(1);
        backface-visibility: hidden;
        transform-origin: 0 0;
      }
      .ldio-lrl344qrunr div {
        box-sizing: content-box;
      }
      #loading {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
/*         display: none; */
      }

      .no-soal {
        flex-basis: 10%;
      }

      .no-soal h2 {
        font-size: 2.5vw;
      }

      .isi-soal {
        flex-basis: 90%;
      }

      .isi-soal p {
        margin: 0 0 1em 0;
        padding: 0 0.75em 0.75em 0.75em;
      }

      .no-soal h2 {
        margin: 0 0 0.83em 0;
      }

      .jawab {
        display: flex;
      }

      .jawab label {
        flex-basis: 10%;
        font-weight: bold;
        font-size: 2vw;
      }

      .input-jawaban {
        flex-basis: 90%;
        display: flex;
      }

      .input-jawaban input {
        margin: 0 1em;
        max-width: 25%;
      }

      .result {
        margin: 0;
        font-size: 1.5vw;
      }

      .submit {
        margin: 0 25px;
        text-align: right;
      }

      .info {
        text-align: left;
        font-size: 1.5vw;
        background-color: var(--red-fill);
        border: 4px solid var(--red-border);
        border-radius: 8px;
        font-weight: bold;
      }

      #warning {
        margin: 0;
      }

      #submitBtn {
        color: black;
        margin: 10px 0;
        border-radius: 8px;
        height: 48px;
        font-size: 1.5vw;
        font-weight: bold;
        background-color: var(--button);
      }

      #submitBtn:hover {
        background-color: var(--button-hover);
        cursor: pointer;
      }
    </style>
  </head>

  <body onload="setSoal()">
    <div id="loading">
      <div class="loadingio-spinner-rolling-xhhxmtgsuq">
        <div class="ldio-lrl344qrunr">
          <div></div>
        </div>
      </div>
    </div>

    <div class="container" id="content">
      <div class="soal-wrap">
        <div class="soal">
          <div class="pertanyaan">
            <div class="no-soal">
              <h2>Soal 1</h2>
            </div>

            <div class="isi-soal" id="soal1">
            </div>
          </div>

          <div class="jawab">
            <label for="jawaban1">Jawaban </label>
            <div class="input-jawaban">
              <input type="text" id="jawaban1" name="jawaban1" value="" />
              <p class="result" id="result1"></p>
            </div>
          </div>
        </div>

        <div class="soal">
          <div class="pertanyaan">
            <div class="no-soal">
              <h2>Soal 2</h2>
            </div>

            <div class="isi-soal" id="soal2"></div>
          </div>

          <div class="jawab">
            <label for="jawaban2">Jawaban </label>
            <div class="input-jawaban">
              <input type="text" id="jawaban2" name="jawaban2" value="" />
              <p class="result" id="result2"></p>
            </div>
          </div>
        </div>
      </div>

      <div class="submit">
        <div class="info">
          <p id="warning">
            Peserta baru bisa kembali ke game utama setelah mengirim jawaban.
            Kosongi kolom jawaban jika tidak ingin menjawab soal.
          </p>
        </div>

        <button id="submitBtn" onclick="confirmSubmit()">Kirim Jawaban</button>
      </div>
    </div>

    <script>
      let baseUrl, curPos, token, team_id, soal_id1, soal_id2, benar1, benar2;

      function confirmSubmit() {
        const confirmed = confirm(
          "Apa kamu sudah yakin ingin mengirim jawaban?"
        );

        if (confirmed) {
          sendAnswer();
        }
      }

      function sendAnswer() {
        event.preventDefault();

        const jawaban1 = document.getElementById("jawaban1");
        const jawaban2 = document.getElementById("jawaban2");
        const result1 = document.getElementById("result1");
        const result2 = document.getElementById("result2");
        const warning = document.getElementById("warning");
        const submitBtn = document.getElementById("submitBtn");

        const link = `${baseUrl}/perempat/insert_jawaban_pos_soal`;

        const request = {
          team_id: team_id,
          jawaban: [
            {
              soal_id: soal_id1,
              isi_jawaban: jawaban1.value,
            },
            {
              soal_id: soal_id2,
              isi_jawaban: jawaban2.value,
            },
          ],
        };

        warning.innerHTML = "Sedang mengirim jawaban...";
        submitBtn.style.display = "none";
        jawaban1.disabled = true;
        jawaban2.disabled = true;

        console.log("Mengirim jawaban");

        fetch(link, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Accept": "application/json",
            "Authorization": "Bearer " + token,
          },
          body: JSON.stringify(request),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            return response.json();
          })
          .then((responseBody) => {
            console.log(responseBody);

            const score1 = responseBody.data[0].jawab_point;
            const score2 = responseBody.data[1].jawab_point;
            const totalScore = score1 + score2;

            warning.innerHTML = "Jawaban berhasil dikirim";

            if (jawaban1.value == "") {
              jawaban1.style.backgroundColor = getComputedStyle(
                document.documentElement
              ).getPropertyValue("--empty-fill");
              jawaban1.style.border =
                "2px solid " +
                getComputedStyle(document.documentElement).getPropertyValue(
                  "--empty-border"
                );
              jawaban1.style.color = "#f5f5f5";

              result1.innerHTML = "TIDAK MENJAWAB";
              result1.style.color = getComputedStyle(
                document.documentElement
              ).getPropertyValue("--empty-text");
            } else {
              if (score1 == benar1) {
                jawaban1.style.backgroundColor = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--correct-fill");
                jawaban1.style.border =
                  "2px solid " +
                  getComputedStyle(document.documentElement).getPropertyValue(
                    "--correct-border"
                  );
                jawaban1.style.color = "#0f0f0f";

                result1.innerHTML = "BENAR";
                result1.style.color = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--correct-text");
              } else {
                jawaban1.style.backgroundColor = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--wrong-fill");
                jawaban1.style.border =
                  "2px solid " +
                  getComputedStyle(document.documentElement).getPropertyValue(
                    "--wrong-border"
                  );
                jawaban1.style.color = "#f5f5f5";

                result1.innerHTML = "SALAH";
                result1.style.color = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--wrong-text");
              }
            }

            if (jawaban2.value == "") {
              jawaban2.style.backgroundColor = getComputedStyle(
                document.documentElement
              ).getPropertyValue("--empty-fill");
              jawaban2.style.border =
                "2px solid " +
                getComputedStyle(document.documentElement).getPropertyValue(
                  "--empty-border"
                );
              jawaban2.style.color = "#f5f5f5";

              result2.innerHTML = "TIDAK MENJAWAB";
              result2.style.color = getComputedStyle(
                document.documentElement
              ).getPropertyValue("--empty-text");
            } else {
              if (score2 == benar2) {
                jawaban2.style.backgroundColor = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--correct-fill");
                jawaban2.style.border =
                  "2px solid " +
                  getComputedStyle(document.documentElement).getPropertyValue(
                    "--correct-border"
                  );
                jawaban2.style.color = "#0f0f0f";

                result2.innerHTML = "BENAR";
                result2.style.color = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--correct-text");
              } else {
                jawaban2.style.backgroundColor = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--wrong-fill");
                jawaban2.style.border =
                  "2px solid " +
                  getComputedStyle(document.documentElement).getPropertyValue(
                    "--wrong-border"
                  );
                jawaban2.style.color = "#f5f5f5";

                result2.innerHTML = "SALAH";
                result2.style.color = getComputedStyle(
                  document.documentElement
                ).getPropertyValue("--wrong-text");
              }
            }

            parent.c3_callFunction("answerSent", [
              totalScore,
              soal_id1,
              soal_id2,
            ]);
          })
          .catch((error) => {
            console.error(error);
            warning.innerHTML = "Gagal mengirim jawaban. Silahkan coba lagi";
            submitBtn.style.display = "";
          });
      }

      function setSoal() {
        baseUrl = sessionStorage.getItem("apiBase");
        curPos = sessionStorage.getItem("curPos");
        token = sessionStorage.getItem("token");
        team_id = sessionStorage.getItem("team_id");

        const link = `${baseUrl}/perempatsoal/pos/${curPos}`;

        console.log("Mengambil soal");

        fetch(link, {
          headers: {
            "Content-Type": "application/json",
            "Accept": "application/json",
            "Authorization": "Bearer " + token,
          },
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            return response.json();
          })
          .then((data) => {
            console.log(data);
            const soal1 = document.getElementById("soal1");
            const soal2 = document.getElementById("soal2");
            const loading = document.getElementById("loading");
            const content = document.getElementById("content");

            soal1.innerHTML = `
					${data[0].isi_soal}
					`;

            soal_id1 = data[0].id;
            benar1 = data[0].poin_benar;

            soal2.innerHTML = `
					${data[1].isi_soal}
					`;

            soal_id2 = data[1].id;
            benar2 = data[1].poin_benar;

            content.style.display = "block";
            loading.style.display = "none";

            parent.c3_callFunction("setIdSoal", [soal_id1, soal_id2]);
          })
          .catch((error) => {
            console.error(error);
            console.log("Retrying in 10 seconds");
            setTimeout(setSoal, 10000);
          });
      }
    </script>
  </body>
</html>
