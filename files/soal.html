<!DOCTYPE html>
<html>

<head>
    <style>

		.flex-container {
			display: flex;
			justify-content:center;
		}
		
        body { 
			height: 100%;
			background-color: rgb(15, 15, 15);
		}

		p {
			color: rgb(245, 245, 245);
			padding: 0.75em;
		}

		label {
			color: rgb(245, 245, 245);
			padding-bottom: 0.5em;
		}

		.soal {
			justify-content: center;
			font-size: 1.5vw;
			color: rgb(225, 225, 225);
			max-width: 50vw;
			align-content: center;
			text-align: left;
			background-color: rgb(30,30,30);			
			border: 4px solid rgb(44, 44, 44);
			border-radius: 8px;
			display: none;
		}
		
		:root {
			--input-border: #8b8a8b;
			--input-focus-h: 245;
			--input-focus-s: 100%;
			--input-focus-l: 42%;
		}
		input[type=text] {
			font-size: 16px;
			font-size: max(16px, 1em);
			font-family: inherit;
			padding: 0.25em 0.5em;
			background-color: #fff;
			border: 2px solid var(--input-border);
			border-radius: 4px;
			transition: 180ms box-shadow ease-in-out;
		}

		input[type=text]:focus {
			border-color: hsl(var(--input-focus-h), var(--input-focus-s), var(--input-focus-l));
			box-shadow: 0 0 0 3px hsla(var(--input-focus-h), var(--input-focus-s), calc(var(--input-focus-l) +
          	40%), 0.8);
			outline: 3px solid transparent;
		}
		
		#submit {
			display: none;
		}
    </style>
</head>

<body onload="setSoal()">
	<p id="loading">Loading...</p>
	
	<div class="flex-containter">
		
		<div class="soal" id="soal1"></div>

		<div class="soal" id="soal2"></div>

		<p>Peserta baru bisa kembali ke game utama setelah mensubmit jawaban. Kosongi kolom jawaban jika tidak ingin menjawab soal.</p>
		<button id="submit" onclick="sendAnswer()">Submit Jawaban</button>

		<p id="warning"></p>

	</div>
	<script>
		let baseUrl, curPos, token, team_id, soal_id1, soal_id2, benar1, benar2;
	
		function sendAnswer() {
			event.preventDefault();
			
			const jawaban1 = document.getElementById("jawaban1").value;
			const jawaban2 = document.getElementById("jawaban2").value;
			const warning = document.getElementById("warning");
			const submit = document.getElementById("submit");
			
			const link = `${baseUrl}/perempat/insert_jawaban_pos_soal`;
			
			const request = {
				"team_id": team_id,
				"jawaban": [
					{
						"soal_id": soal_id1,
						"isi_jawaban": jawaban1 != "" ? jawaban1 : null
					},
					{
						"soal_id": soal_id2,
						"isi_jawaban": jawaban2 != "" ? jawaban2 : null
					},
				]
			}
			
			warning.innerHTML = "Sedang mengirim jawaban...";
			submit.style.display = 'none';
			
			fetch(link, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json',
					'Authorization': 'Bearer ' + token
				},
				body: JSON.stringify(request)
        	})
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
				
                return response.json()
            })
            .then(responseBody => {
				const score1 = responseBody.data[0].jawab_point;
				const score2 = responseBody.data[1].jawab_point;
				const totalScore = score1 + score2;
				
				warning.innerHTML = '<p>Jawaban berhasil dikirim</p>';
				
				if(jawaban1 != "") {
					warning.innerHTML += `<p>Jawaban soal 1 anda ${score1 == benar1 ? "benar" : "salah"}</p>`
				}
				
				if(jawaban2 != "") {
					warning.innerHTML += `<p>Jawaban soal 2 anda ${score2 == benar2 ? "benar" : "salah"}</p>`
				}
				
				parent.c3_callFunction("answerSent", [totalScore]);
            })
            .catch(error => {
				console.error(error);
				warning.innerHTML = "Gagal mengirim jawaban. Silahkan coba lagi";
				submit.style.display = 'block';
			});
		}

		function setSoal() {
			baseUrl = sessionStorage.getItem("apiBase");
			curPos = sessionStorage.getItem("curPos");
			token = sessionStorage.getItem("token");
			team_id = sessionStorage.getItem("team_id");
			
			const link = `${baseUrl}/perempatsoal/pos/${curPos}`;
			
			fetch(link, {
				headers: {
					'Content-Type': 'application/json',
					'Accept': 'application/json',
					'Authorization': 'Bearer ' + token
				},
        	})
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
				
                return response.json()
            })
            .then(data => {
				console.log(data);
                const soal1 = document.getElementById("soal1");
                const soal2 = document.getElementById("soal2");
				const loading = document.getElementById("loading");
				const submit = document.getElementById("submit");
				
                soal1.innerHTML = `
				<h2>Soal 1</h2>
				${data[0].isi_soal}
				<label for="jawaban1">Jawaban: </label>
				<input type="text" id="jawaban1" name="jawaban1" value=""><br>
				`;
				
				soal_id1 = data[0].id;
				benar1 = data[0].poin_benar;
				
                soal2.innerHTML = `
				<h2>Soal 2</h2>
				${data[1].isi_soal}
				<label for="jawaban2">Jawaban: </label>
				<input type="text" id="jawaban2" name="jawaban2" value=""><br>
				`;
				
				soal_id2 = data[1].id;
				benar2 = data[1].poin_benar;
				
				soal1.style.display = 'block';
				soal2.style.display = 'block';
				submit.style.display = 'block';
				loading.style.display = 'none';
            })
            .catch(error => {
				console.error(error);
				console.log("Retrying in 10 seconds");
				setTimeout(setSoal, 10000);
			});
		}
	</script>
</body>

</html>